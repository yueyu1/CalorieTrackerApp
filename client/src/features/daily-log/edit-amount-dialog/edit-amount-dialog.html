<div class="edit-dialog">
  <!-- Header -->
  <div class="edit-dialog-header">
    <div class="edit-dialog-title-group">
      <h2 class="edit-dialog-title">Edit amount</h2>
      <p class="edit-dialog-subtitle">
        {{ data.brand ? (data.brand + ' ' + data.name) : data.name }}
      </p>
    </div>

    <button mat-icon-button type="button" class="close-btn" (click)="onCancel()" [disabled]="isUpdating()">
      <mat-icon fontIcon="close"></mat-icon>
    </button>
  </div>

  <!-- Content -->
  <form class="edit-dialog-body" [formGroup]="form" (ngSubmit)="onSave()">
    <!-- Quantity + Unit -->
    <div class="quantity-row">
      <mat-form-field appearance="outline" class="quantity-field">
        <mat-label>Quantity</mat-label>
        <input matInput type="number" min="0" step="0.5" formControlName="quantity" />
        @if (quantityCtrl?.hasError('required')) {
          <mat-error>Quantity is required</mat-error>
        }
        @if (quantityCtrl?.hasError('min')) {
          <mat-error>Must be greater than 0</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="unit-field">
        <mat-label>Unit</mat-label>
        <mat-select formControlName="unitId">
          @for (u of data.units; track u) {
            <mat-option [value]="u.code">
              {{ u.label }}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Equivalent grams / simple text -->
    @if (previewText) {
      <div class="preview-row">
        <span class="preview-label">Equivalent:</span>
        <span class="preview-value">{{ previewText }}</span>
      </div>
    }

    <!-- Macros for this amount -->
    <div class="macros-row">
      <div class="macros-label">Macros for this amount</div>

      <div class="macros-chips">
        <div class="macro-chip macro-chip--calories">
          <span class="macro-chip-name">Calories</span>
          <span class="macro-chip-value">{{ macros.calories | number:'1.0-0' }}</span>
          <span class="macro-chip-unit">kcal</span>
        </div>

        <div class="macro-chip macro-chip--protein">
          <span class="macro-chip-name">Protein</span>
          <span class="macro-chip-value">{{ macros.protein | number:'1.0-2' }}</span>
          <span class="macro-chip-unit">g</span>
        </div>

        <div class="macro-chip macro-chip--carbs">
          <span class="macro-chip-name">Carbs</span>
          <span class="macro-chip-value">{{ macros.carbs | number:'1.0-2' }}</span>
          <span class="macro-chip-unit">g</span>
        </div>

        <div class="macro-chip macro-chip--fat">
          <span class="macro-chip-name">Fat</span>
          <span class="macro-chip-value">{{ macros.fat | number:'1.0-2' }}</span>
          <span class="macro-chip-unit">g</span>
        </div>
      </div>
    </div>


    <!-- Footer actions -->
    <div class="edit-dialog-footer">
      <button mat-button type="button" class="secondary-btn" (click)="onCancel()" [disabled]="isUpdating()">
        Cancel
      </button>

      <button mat-flat-button color="primary" type="submit" class="save-btn" [disabled]="form.invalid || isUpdating()">
        @if (!isUpdating()) {
          Save
        }
        @else {
          <mat-progress-spinner
            diameter="18"
            mode="indeterminate"
            class="btn-spinner">
          </mat-progress-spinner>
          <span class="saving-text">Savingâ€¦</span>
        }
      </button>
    </div>
  </form>
</div>